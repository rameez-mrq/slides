<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="../dist/reset.css">
    <link rel="stylesheet" href="../dist/reveal.css">
    <link rel="stylesheet" href="../dist/theme/black.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="../plugin/highlight/atom.css">
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section data-background-color="white">



                <h2>Blending Knowledge for blended conversations</h2>
                <p style="text-align: center; font-size: small;">1st September 2022</p>
                <p style="text-align: center;">Rameez Qureshi</p>

                <img data-src="../media\logos\ADAPT_Logo_CMYK.png"
                    style=" position : fixed; bottom :0 ; right : 0; width: 150px">
                <img data-src="../media\logos\tcd.png" style=" position : fixed; bottom :0 ; left : 0; width: 150px">
            </section>


            <section>
                <!-- <h2 data-id="title" style="position : absolute; top : 40%; font-size : 50px">Contents </h2> -->
                <h2>Contents</h2>
                <ul>
                    <li style="margin: 15px 0">Recap</li>
                    <li style="margin: 15px 0">Outline of ParlAI</li>
                    <li style="margin: 15px 0">Problem Statement</li>
                    <li style="margin: 15px 0">Codebase</li>
                    <li style="margin: 15px 0">Current Status</li>
                    <!-- <li class="fragment">And others...</li> -->
                </ul>

            </section>

            <section data-transition="fade">
                <img src="../pres/figures/7april22/arch_wrl.png" style="max-width: 85%; padding: 0;">
            </section>
            <section data-transition="fade">
                <img src="../media/figures/26aug22/archi.png" style="max-width: 85%; padding: 0;">
            </section>

            <section data-background-iframe="https://parl.ai" data-background-interactive>
                <div
                    style="position: absolute; width: 40%; bottom: 0; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); color: #fff; padding: 20px; font-size: 20px; text-align: left; margin-bottom: 0%; margin-right: 0em;">
                    <h2>ParlAI Framework</h2>
                    <p>As all the SOTA dialogue models follow ParlAI strucuture, therefore the proposed model has to be
                        written with ParlAI subclasses.</p>
                </div>
            </section>
            <section>
                <img src="../media/figures/26aug22/parlai_world.png" style="max-width: 65%; padding: 0;">
            </section>

            <section>
                <img src="../media/figures/26aug22/pipeline.png">
            </section>

            <section>
                <img src="../media/figures/26aug22/agent_act.jpeg" style="max-width: 55%; padding: 0;">
            </section>


            <section>
                <img src="../media/figures/26aug22/Example.png">
            </section>

            <section>
                <img src="../media/figures/26aug22/hierarchy.png" style="max-width: 55%; padding: 0;">
            </section>

            <section data-transition="zoom" data-background-color="#ff8f8f" data-background-transition="zoom">
                <link rel="stylesheet" href="plugin/highlight/monokai.css">
                <pre class="stretch">
                    <code  data-line-numbers="2-2|4-38|40-54|56-62|64-75">
    def forward(self, input, encoder_state, incr_state=None):

    attention_mask = None
    position_ids = None
    if incr_state is None:
        # first step
        if (
            not self.add_start_token
            and input.size(1) == 1
            and int(input[0][0]) == self.START_IDX
        ):
            # generating: ignore the start token
            # without deep copy, the padding_idx (-1) in encoder_state can be reset to 0 with clamp_ inplace operation
            model_input = encoder_state.clone()
        else:
            # forced decoding: concatenate the context
            # with the labels
            model_input = torch.cat([encoder_state, input], dim=-1)
        attention_mask = model_input != self.NULL_IDX
        position_ids = (
            attention_mask.cumsum(dim=-1, dtype=torch.int64) - 1
        ).clamp_(min=0)
    else:
        if not self.add_start_token:
            input = input[:, 1:]
        # generating with continuation
        # get the position ids
        position_ids = (encoder_state != self.NULL_IDX).sum(
            -1, True, dtype=torch.int64
        ) - 1
        delta = ((input != self.NULL_IDX)).sum(-1, True, dtype=torch.int64)
        position_ids += delta
        # generation: get the last token input
        model_input = input[:, -1:]
        attention_mask = torch.cat([encoder_state, input], dim=-1) != self.NULL_IDX

    model_input = model_input.clamp_(min=0)

        '''
        Insert the two decoders here.
        '''

        decoder_one = pretrained_agent.model.decoder(input, encoder_state)
        decoded_first = decoder_one[0] * wiki_factor

        decoder_two = pretrained_agent_2.model.decoder(input, encoder_state)
        decoded_second = decoder_two[0] * emp_factor

        decoded_merged = decoded_first.add(decoded_second)
        
        '''
        END of custom decoders
        '''

        ''' 
        Write blocks here
        '''
        hidden_states = self.blocks(decoded_merged)
        '''
        End of blocks
        '''

        if incr_state == None:

            output = hidden_states[:, -input.size(1) :]

            lengths = (input != self.NULL_IDX).sum(dim=-1)
            for i in range(input.size(0)):
                output[i, input.size(1) - lengths[i]] = output[i, 0]

        else:
            output = hidden_states

        return output, None
                    </code>
                </pre>
            </section>

            <section data-background-color="white">
                <figure>
                    <img src="../media/figures/26aug22/gpt-2.gif" style="max-width: 90%; padding: 0;">
                    <figcaption style="font-size: 0.4cm;">Source: <a
                            href="https://jalammar.github.io/illustrated-gpt2/">Jay Alammar's Blog</a></figcaption>
                </figure>
            </section>


            <section>
                <img src="../media/figures/26aug22/Example.png">
            </section>


            <section data-background-color="#fe4a49">
                <h2>Well, it finally worked!</h2>
            </section>

            <section>
                <section style="text-align: left;">
                    <h2>Persona</h2>
                    <br><br>
                    I work as an electrician. I always sleep 8 hours a day.
                    <br><br>
                    Electrician.<br>
                    That sounds dangerous. Is it worth doing such a dangerous job?<br>
                    Well it is okay if you are well trained. There are three levels: Apprentice, journeyman and Master.
                </section>
                <section>
                    <h3>Which level are you at?</h3><br><br>
                    <text style="color:#FFB600">WIKI: I am a journeyman. I am a certified electrician. I am a certified apprentice. I am a certified apprentice.</text><br><br>
                    <text style="color:#FF4921">EMP: I am Master. I am a journeyman.</text>
                </section>

                <section>
                    <h3>Thats great! How long have you been doing this work?</h3><br><br>
                    <text style="color:#FFB600">WIKI: I have been working as an apprentice for about 10 years now.</text><br><br>
                    <text style="color:#FF4921">EMP: I started in August</text>
                </section>

                <section>
                    <h3>Sounds like it could be a dangerous job at times.</h3><br><br>
                    <text style="color:#FFB600">WIKI: It is dangerous. I am a certified electrician and I am a certified electrician.</text><br><br>
                    <text style="color:#FF4921">EMP: It is. I am very careful with my safety.</text>
                </section>

                <section>
                    <h3>Well you have entered a trade that will always guarantee you some work.</h3><br><br>
                    <text style="color:#FFB600">WIKI: I am a certified electrician, so i know a lot about electrical systems.</text><br><br>
                    <text style="color:#FF4921">EMP: I agree. I am going to do my best to stay on top of it.</text>
                </section>

                <section>
                    <h3>I have a pretty stable job myself, but mostly desk work</h3><br><br>
                    <text style="color:#FFB600">WIKI: Do you work in a building or a building?</text><br><br>
                    <text style="color:#FF4921">EMP: I am sure you will be fine.</text>
                </section>

                <section>
                    <h3>I really do but sometimes I would like to be active and on my feet more.</h3><br><br>
                    <text style="color:#FFB600">WIKI: Do you have a favorite hobby?</text><br><br>
                    <text style="color:#FF4921">EMP: I am glad you have a job that allows you to do that.</text>
                </section>

                <section>
                    <h2>Merger Models</h2>
                    <ol>
                        <li style="margin: 35px 0; color:#fe4a49; font-size:40px">80% Wiki - 20% Empathy  [W]</li>
                        <li style="margin: 35px 0; color:#2ab7ca; font-size:40px">20% Wiki - 80% Empathy  [E]</li>
                        <li style="margin: 35px 0; color:#fed766; font-size:40px">50% Wiki - 50% Empathy  [B]</li>
                        <!-- <li class="fragment">And others...</li> -->
                    </ol>
                </section>

                <section data-auto-animate>
                    <h3>I really do but sometimes I would like to be active and on my feet more.</h3><br><br>
                    WIKI: Do you have a favorite hobby?<br><br>
                    EMP: I am glad you have a job that allows you to do that.<br><br><br><br>
                    <div data-id = "example">
                        <text style="color:#fe4a49">?: That's great. I'm sure you'll do great!</text><br><br>
                        <text style="color:#2ab7ca">?: I do, but I also enjoy being a physical person.</text><br><br>
                        <text style="color:#fed766">?: That's a good attitude to have.</text>
                </div>

                </section>


                <section  data-auto-animate>
                    <div data-id = "example">
                        
                        <text style="color:#fe4a49; font-size:40px">W: That's great. I'm sure you'll do great!</text><br><br>
                        <text style="color:#2ab7ca ; font-size:40px">E: I do, but I also enjoy being a physical person.</text><br><br>
                        <text style="color:#fed766 ; font-size:40px">B: That's a good attitude to have.</text>
                    </div>
                </section>

            </section>
            <section data-background-color="#dcedc1">
                <img src="../media/figures/26aug22/example_1.png" style="max-width: 80%; padding: 0;">
            </section>
            <section data-background-color="#dcedc1">
                <img src="../media/figures/26aug22/example_2.png">
            </section>

            <section data-background-color="#dcedc1">
                <h2>Thank you!</h2>
            </section>
            <section data-background-color="#dcedc1" style="text-align: left; font-size:25px">
                <h2>References</h2>

                <sub>Dinan, Emily, Stephen Roller, Kurt Shuster, Angela Fan, Michael Auli, and Jason Weston. "Wizard of
                    Wikipedia: Knowledge-Powered Conversational Agents." ArXiv:1811.01241 [Cs], February 21, 2019.
                    http://arxiv.org/abs/1811.01241.</sub><br><br>

                <sub>Rashkin, Hannah, Eric Michael Smith, Margaret Li, and Y.-Lan Boureau. "Towards Empathetic
                    Open-Domain Conversation Models: A New Benchmark and Dataset." ArXiv:1811.00207 [Cs], August 28,
                    2019. http://arxiv.org/abs/1811.00207.</sub><br><br>

                <sub>Roller, Stephen, Emily Dinan, Naman Goyal, Da Ju, Mary Williamson, Yinhan Liu, Jing Xu, et al.
                    "Recipes for Building an Open-Domain Chatbot." ArXiv:2004.13637 [Cs], April 30, 2020.
                    http://arxiv.org/abs/2004.13637.</sub><br><br>

                <sub>Smith, Eric Michael, Mary Williamson, Kurt Shuster, Jason Weston, and Y.-Lan Boureau. "Can You Put
                    It All Together: Evaluating Conversational Agents" Ability to Blend Skills." ArXiv:2004.08449 [Cs],
                    April 17, 2020. http://arxiv.org/abs/2004.08449.</sub>
            </section>

        </div>
    </div>

    <script src="../dist/reveal.js"></script>
    <script src="../plugin/notes/notes.js"></script>
    <script src="../plugin/markdown/markdown.js"></script>
    <script src="../plugin/highlight/highlight.js"></script>
    <script src="../plugin/zoom/zoom.js"></script>
    <script>
        // More info about initialization & config:
        // - https://revealjs.com/initialization/
        // - https://revealjs.com/config/
        Reveal.initialize({
            slideNumber: true,
            controls: true,
            progress: true,
            center: true,
            hash: true,
            // Transition style
            transition: 'fade', // none/fade/slide/convex/concave/zoom

            // Transition speed
            // transitionSpeed: 'default',
            backgroundTransition: 'slide', // default/fast/slow

            //transition: "none",

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom]
        });
    </script>
</body>

</html>